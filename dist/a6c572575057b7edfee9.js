function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var a=0;a<r.length;a++){var s=r[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,r,a){return r&&_defineProperties(e.prototype,r),a&&_defineProperties(e,a),e}function _defineProperty(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}import"core-js/modules/es.weak-map.js";import"core-js/modules/esnext.weak-map.delete-all.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.string.iterator.js";import"core-js/modules/es.array.iterator.js";import"core-js/modules/web.dom-collections.iterator.js";import{saveToLocalStorage,loadObjectLocalStorage,loadWeakMapFromLocalStorage}from"./localStorage.js";import GameUser from"./userDatabase.js";import UserDatabaseUI from"./UI_UserDatabase.js";import GameManager from"./GameManager.js";import{renderUserDatabase}from"./UI_UserDatabase.js";var userDatabase=loadObjectLocalStorage("gameUsers"),_currentUser=new WeakMap,currentUser={set:function(e){_currentUser.set(this,e)},get:function(){return _currentUser.get(this)}},UserDatabaseFunctionality=function(){function e(){var r=this;_classCallCheck(this,e),_defineProperty(this,"updateCurrentUser",(function(e){currentUser.set(e)})),_defineProperty(this,"loadUserFromDatabase",(function(e,a){r.isUserInDatabase(e)&&r.isUserPasswordCorrect(e,a)?(currentUser.set(e),r.userDatabaseUI.renderUserToDom(e)):r.userDatabaseUI.alertUserCredentialsIncorrect()})),_defineProperty(this,"updateUserGameData",(function(){var e=currentUser.get();if(e){var a=r.newGame.returnStateOfGame().gameWord;r.newGame.isGameWon()?userDatabase[e].gamesWon++:userDatabase[e].gamesLost++,userDatabase[e].gamesPlayed++,userDatabase[e].wordsPlayed.push(_defineProperty({},a,r.newGame.getResult()))}saveToLocalStorage("gameUsers",userDatabase)})),_defineProperty(this,"isUserInDatabase",(function(e){return!!userDatabase[e]})),_defineProperty(this,"isUserPasswordCorrect",(function(e,r){return GameUser.prototype.checkPassword.call(userDatabase[e],r)})),this.newGame=new GameManager(this.updateUserGameData.bind(this)),this.userDatabaseUI=new UserDatabaseUI(this.setUpNewUser.bind(this),this.loadUserFromDatabase.bind(this))}return _createClass(e,[{key:"setUpNewUser",value:function(e,r){this.userAlreadyExists(e)?this.userDatabaseUI.alertUserAlreadyExists():(this.createNewUser(e,r),this.updateCurrentUser(e),saveToLocalStorage("gameUsers",userDatabase),this.userDatabaseUI.renderUserToDom(e),renderUserDatabase())}},{key:"createNewUser",value:function(e,r){userDatabase[e]=new GameUser(e,r)}},{key:"userAlreadyExists",value:function(e){return!!userDatabase.hasOwnProperty(e)}}]),e}();new UserDatabaseFunctionality;